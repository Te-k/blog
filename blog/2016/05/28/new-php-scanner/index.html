<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>New PHP scanner &middot; Tek</title>

  
  <link rel="stylesheet" href="http://te-k.github.io/css/poole.css">
  <link rel="stylesheet" href="http://te-k.github.io/css/hyde.css">
  <link rel="stylesheet" href="http://te-k.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="http://te-k.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://te-k.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="http://te-k.github.io/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://te-k.github.io/touch-icon-144-precomposed.png">
  <link href="http://te-k.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Your default page description">
  <meta name="keywords" content="php,tools,malware,backdoor">
  
</head>
<body class="layout-reverse">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1><a href="http://te-k.github.io/">Te(k|ch) blog</a></h1>
      <p class="lead">Funny security stuff</p>
    </div>
    <img src="/img/avatar.jpg"/>
    <br/>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="http://te-k.github.io/privacy/">#privacy</a></li>
      
      <li class="sidebar-nav-item"><a href="http://te-k.github.io/references/">#references</a></li>
      
      <li class="sidebar-nav-item"><a href="http://te-k.github.io/about/">#whoami</a></li>
      
    </ul>

    <br/>


    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/Te-k"><i class="fa fa-github-square fa-3x"></i></a>
      <a href="https://twitter.com/tenacioustek"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      
      
      
      
      
      <a href="http://te-k.github.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    <div class="sidebar-copyright">
        <p>
       <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/media/cc.png" /></a>
        Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">New PHP scanner</h1>
    <span class="post-date">May 28, 2016 &middot; 2 minute read
    
    <br/>
    <a class="label" href="http://te-k.github.io/categories/malware">malware</a><a class="label" href="http://te-k.github.io/categories/php">php</a><a class="label" href="http://te-k.github.io/categories/tools">tools</a>
    </span>
    <p>Oi!</p>

<p>Following <a href="http://te-k.github.io/blog/2016/05/14/comparison-of-php-scanners/">the last post</a>, I started to combine the different ideas in a new tools.</p>

<p>So I developed <a href="https://github.com/Te-k/phpscanner">PHP Scanner</a> which uses three different methods for identifying PHP backdoors:</p>

<ul>
<li>Yara signatures: I reused <a href="https://github.com/nbs-system/php-malware-finder">php-malware-finder</a> signatures, extracted/converted ClamAV signatures and created new custom one based on different php sample</li>
<li>After several tests, it appeared that the static analysis made by <a href="https://github.com/planet-work/php-malware-scanner">php-malware-scanner</a> was pretty good in many cases, and with few false positive. So I reused directly their code as a detection mean</li>
<li>File hash: I made a database of hash for all Joomla/Wordpress/Drupal versions I could find</li>
</ul>

<p><center><img src="/media/doctor3.jpg" alt="Doctor" /></center></p>

<p>It provides good results even though the hash database creates many false positives (I don&rsquo;t exactly understand why).</p>

<p>Here is the help:</p>

<pre><code class="language-sql">usage: phpscanner.py [-h] [-s] [-O] [-v] [-1] [-2] [-3] [-q] FILE [FILE ...]

Look for malicious php

positional arguments:
  FILE               List of files or directories to be analyzed

optional arguments:
-h, --help         show this help message and exit
-s, --suspicious   Add rules for suspicious files (more FP)
-O, --fingerprint  Fingerprint the framework version
-v, --verbose      verbose level... repeat up to three times.
-1, --signature    Uses only the signatures
-2, --pms          Uses only the Php Malware Scanner tool
-3, --hash         Uses only the hash comparison
-q, --quiet        Hide scan summary
</code></pre>

<p>And an example of results:</p>

<pre><code class="language-sql">&gt; python2 phpscanner.py .

./xmlrpc.php -&gt; [SIGNATURE (phpobfuscator)] [PMS] [HASH]
./lib.php -&gt; [PMS]
./includes/bootstrap.inc -&gt; [SIGNATURE (pseudo_darkleech)]
./themes/garland/search.php -&gt; [SIGNATURE (phpobfuscator_global)] [PMS]
./sites/all/libraries/tcpdf/tcpdf_parser.php -&gt; [SIGNATURE (phpobfuscator)] [PMS]
./sites/all/libraries/tcpdf/examples/index.php -&gt; [HASH]
./sites/all/libraries/tcpdf/include/barcodes/.option26.php -&gt; [PMS]
./sites/all/libraries/galleria/plugins/.session10.php -&gt; [PMS]
./sites/all/libraries/ckeditor/_source/plugins/flash/dialogs/.plugin19.php -&gt; [PMS]
./sites/all/libraries/ckeditor/_samples/sample_posteddata.php -&gt; [SIGNATURE (misc_php_backdoor)]
./sites/all/modules/contrib/wysiwyg/editors/css/.themes42.php -&gt; [PMS]
./sites/all/modules/contrib/transliteration/data/xb2.php -&gt; [HASH]
./sites/all/modules/contrib/currency/currency/vendor/autoload.php -&gt; [HASH]

[...]
--------------------------------------------
8969 files scanned
45 suspicious files found
Execution time: 84.1029829979 seconds
</code></pre>

<p>As there is a database of hash, it is also possible to fingerprint Joomla/Drupal/Wordpress version:</p>

<pre><code class="language-sql">python2 phpscanner.py -O .

Seems to be DRUPAL7.22 (110 files)
Can also be DRUPAL7.23 (102), DRUPAL7.24 (101), DRUPAL7.25 (96), DRUPAL7.27 (96)
</code></pre>

<p>The code is available <a href="https://github.com/Te-k/phpscanner">here</a> under <a href="https://github.com/Te-k/phpscanner/blob/master/LICENSE">MIT licence</a></p>

<p>If you have any feedback or comment, please comment on <a href="https://twitter.com/">Twitter</a> or open an issue on <a href="https://github.com/Te-k/phpscanner/issues">Github</a> or a <a href="https://github.com/Te-k/phpscanner/pulls">pull request</a>.</p>

<p>Say≈çnara!</p>

  </div>
  
</div>




<script src="http://te-k.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

