<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.20.2" />

  <title>New PHP scanner &middot; Te(k|ch) blog</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  

  <link rel="shortcut icon" href="https://www.randhome.io/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/references/">#references</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/">#whoami</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>New PHP scanner</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>28 May 2016, 21:41</time>
  </div>

  

  

  

</div>

  <p>Oi!</p>

<p>Following <a href="http://te-k.github.io/blog/2016/05/14/comparison-of-php-scanners/">the last post</a>, I started to combine the different ideas in a new tools.</p>

<p>So I developed <a href="https://github.com/Te-k/phpscanner">PHP Scanner</a> which uses three different methods for identifying PHP backdoors:</p>

<ul>
<li>Yara signatures: I reused <a href="https://github.com/nbs-system/php-malware-finder">php-malware-finder</a> signatures, extracted/converted ClamAV signatures and created new custom one based on different php sample</li>
<li>After several tests, it appeared that the static analysis made by <a href="https://github.com/planet-work/php-malware-scanner">php-malware-scanner</a> was pretty good in many cases, and with few false positive. So I reused directly their code as a detection mean</li>
<li>File hash: I made a database of hash for all Joomla/Wordpress/Drupal versions I could find</li>
</ul>

<p><center><img src="/media/doctor3.jpg" alt="Doctor" /></center></p>

<p>It provides good results even though the hash database creates many false positives (I don&rsquo;t exactly understand why).</p>

<p>Here is the help:</p>

<pre><code class="language-sql">usage: phpscanner.py [-h] [-s] [-O] [-v] [-1] [-2] [-3] [-q] FILE [FILE ...]

Look for malicious php

positional arguments:
  FILE               List of files or directories to be analyzed

optional arguments:
-h, --help         show this help message and exit
-s, --suspicious   Add rules for suspicious files (more FP)
-O, --fingerprint  Fingerprint the framework version
-v, --verbose      verbose level... repeat up to three times.
-1, --signature    Uses only the signatures
-2, --pms          Uses only the Php Malware Scanner tool
-3, --hash         Uses only the hash comparison
-q, --quiet        Hide scan summary
</code></pre>

<p>And an example of results:</p>

<pre><code class="language-sql">&gt; python2 phpscanner.py .

./xmlrpc.php -&gt; [SIGNATURE (phpobfuscator)] [PMS] [HASH]
./lib.php -&gt; [PMS]
./includes/bootstrap.inc -&gt; [SIGNATURE (pseudo_darkleech)]
./themes/garland/search.php -&gt; [SIGNATURE (phpobfuscator_global)] [PMS]
./sites/all/libraries/tcpdf/tcpdf_parser.php -&gt; [SIGNATURE (phpobfuscator)] [PMS]
./sites/all/libraries/tcpdf/examples/index.php -&gt; [HASH]
./sites/all/libraries/tcpdf/include/barcodes/.option26.php -&gt; [PMS]
./sites/all/libraries/galleria/plugins/.session10.php -&gt; [PMS]
./sites/all/libraries/ckeditor/_source/plugins/flash/dialogs/.plugin19.php -&gt; [PMS]
./sites/all/libraries/ckeditor/_samples/sample_posteddata.php -&gt; [SIGNATURE (misc_php_backdoor)]
./sites/all/modules/contrib/wysiwyg/editors/css/.themes42.php -&gt; [PMS]
./sites/all/modules/contrib/transliteration/data/xb2.php -&gt; [HASH]
./sites/all/modules/contrib/currency/currency/vendor/autoload.php -&gt; [HASH]

[...]
--------------------------------------------
8969 files scanned
45 suspicious files found
Execution time: 84.1029829979 seconds
</code></pre>

<p>As there is a database of hash, it is also possible to fingerprint Joomla/Drupal/Wordpress version:</p>

<pre><code class="language-sql">python2 phpscanner.py -O .

Seems to be DRUPAL7.22 (110 files)
Can also be DRUPAL7.23 (102), DRUPAL7.24 (101), DRUPAL7.25 (96), DRUPAL7.27 (96)
</code></pre>

<p>The code is available <a href="https://github.com/Te-k/phpscanner">here</a> under <a href="https://github.com/Te-k/phpscanner/blob/master/LICENSE">MIT licence</a></p>

<p>If you have any feedback or comment, please comment on <a href="https://twitter.com/">Twitter</a> or open an issue on <a href="https://github.com/Te-k/phpscanner/issues">Github</a> or a <a href="https://github.com/Te-k/phpscanner/pulls">pull request</a>.</p>

<p>Say≈çnara!</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://www.randhome.io/blog/2016/05/14/comparison-of-php-scanners/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://www.randhome.io/blog/2016/05/14/comparison-of-php-scanners/">Comparison of php scanners</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://www.randhome.io/blog/2016/07/16/machine-learning-for-malware-detection/">Machine learning for malware detection</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://www.randhome.io/blog/2016/07/16/machine-learning-for-malware-detection/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://www.randhome.io/js/ui.js"></script>






</body>
</html>

