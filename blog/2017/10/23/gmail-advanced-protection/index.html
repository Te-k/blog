<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Gmail Advanced Protection &middot; Tek</title>

  
  <link rel="stylesheet" href="https://www.randhome.io/css/poole.css">
  <link rel="stylesheet" href="https://www.randhome.io/css/hyde.css">
  <link rel="stylesheet" href="https://www.randhome.io/css/poole-overrides.css">
  <link rel="stylesheet" href="https://www.randhome.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="https://www.randhome.io/css/hyde-x.css">
  <link rel="stylesheet" href="https://www.randhome.io/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.randhome.io/touch-icon-144-precomposed.png">
  <link href="https://www.randhome.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Your default page description">
  <meta name="keywords" content="gmail,security">
  
</head>
<body class="layout-reverse">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1><a href="/">Te(k|ch) blog</a></h1>
      <p class="lead">Funny security stuff</p>
    </div>
    <img src="/img/avatar.jpg"/>
    <br/>

    <ul class="sidebar-nav">
      
      <li class="sidebar-nav-item"><a href="https://www.randhome.io/references/">#references</a></li>
      
      <li class="sidebar-nav-item"><a href="https://www.randhome.io/about/">#whoami</a></li>
      
    </ul>

    <br/>


    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/Te-k"><i class="fa fa-github-square fa-3x"></i></a>
      <a href="https://twitter.com/tenacioustek"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      
      
      
      
      
      <a href="https://www.randhome.io/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    <div class="sidebar-copyright">
        <p>
       <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/media/cc.png" /></a>
        Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Gmail Advanced Protection</h1>
    <span class="post-date">Oct 23, 2017 &middot; 6 minute read
    
    <br/>
    <a class="label" href="https://www.randhome.io/categories/security">security</a>
    </span>
    

<p>Last week, Google has added a new set of security features in Gmail called <a href="https://landing.google.com/advancedprotection/">&ldquo;Advanced Protection&rdquo;</a>, specifically for high-risk users. It was widely covered by medias (<a href="https://www.wired.com/story/google-advanced-protection-locks-down-accounts/">Wired</a>, <a href="https://www.theverge.com/2017/10/17/16488572/google-advanced-protection-phishing-fraud-security-keys">The Verge</a> or <a href="https://www.reuters.com/article/us-google-cyber/google-launches-advanced-gmail-security-features-for-high-risk-users-idUSKBN1CM1GP">Reuters</a>) and quickly started a debate whether Google is <a href="https://motherboard.vice.com/en_us/article/kz74ym/google-gmail-advanced-protection-security-keys-yubikey">the most secure email provider on the planet</a> or if <a href="https://motherboard.vice.com/en_us/article/pa3ye7/protonmail-gmail-security-comparison">ProtonMail can compete</a>. The main point here to me (and it has been said by many other people everywhere) is whether you trust Google to keep your data or not, depending on your threat model and your opinion about privacy.</p>

<p>But it does not mean we should not understand what Google proposes to  do here. This blog post entends to details these security features and tests them.</p>

<p><img src="/media/doctor3.jpg" alt="Doctor Who" /></p>

<h1 id="google-advanced-protection">Google Advanced Protection</h1>

<p>Here is what Google includes in the Advanced Protection (according to the <a href="https://landing.google.com/advancedprotection/">Google page</a> and <a href="https://www.wired.com/story/google-advanced-protection-locks-down-accounts/">Wired</a>):</p>

<ul>
<li>Log in on Desktop only with a 2 factor authentication USB device</li>
<li>Log in on smartphone only with a 2 factor authentication Bluetooth device</li>
<li>Blocking non-Google apps from accessing Gmail or Google Drive data</li>
<li>Google malware scanner will do more in depth analysis and detection</li>
<li>If you loose access to your account, you will have extra steps to recover access to it</li>
</ul>

<h3 id="usb-universal-2-factor-authentication-on-desktop">USB Universal 2 Factor Authentication on Desktop</h3>

<p>With Advanced Protection, authentication on your Google account will only be possible with an USB key as second factor (i.e. in complement to your password). These devices have been more and more common for the past years following the development of the U2F standard which allowed different constructors to develop such products. This type of second factor is much more secure than text messages (which can be read or stolen either by exploiting issues <a href="https://www.wired.com/2017/05/fix-ss7-two-factor-authentication-bank-accounts/">in the phone network</a>, or by abusing <a href="https://techcrunch.com/2016/06/10/how-activist-deray-mckessons-twitter-account-was-hacked/">your phone provider</a>) or than apps on your phone (which is good but can still be abused by compromising your phone).</p>

<p>You can find the list of 2Fa dongles <a href="http://www.dongleauth.info/dongles/">here</a>, the most common being <a href="https://www.yubico.com/products/yubikey-hardware/fido-u2f-security-key/">the Yubikey</a> which costs around 18USD.</p>


<figure >
    
        <img src="/media/advancedprotection/yubikey.png" />
    
    
    <figcaption>
        <h4>Yubikey U2F device</h4>
        
    </figcaption>
    
</figure>


<p>U2F USB dongles are now accepted by many platforms (Github, Dropbox, Facebook&hellip; you can find the list <a href="http://www.dongleauth.info/">here</a>); you can use them with Chrome and Opera (Firefox will support it <a href="https://www.yubico.com/2017/09/firefox-nightly-enables-support-fido-u2f-security-keys/">soon</a>, there is an <a href="https://addons.mozilla.org/en-US/firefox/addon/u2f-support-add-on/">extension</a> for it but I could not make it work on my laptop).</p>

<h3 id="bluetooth-u2f-dongle">Bluetooth U2F Dongle</h3>

<p>As USB devices are not an option for smartphones, the solution is to use a Bluetooth U2F dongle. For now, Google proposes to use the <a href="https://www.ftsafe.com/products/FIDO/Multi">Security Key made by Feitian</a> (you can find it on <a href="https://www.amazon.com/Feitian-MultiPass-FIDO-Security-Key/dp/B01LYV6TQM">Amazon</a> for ~25USD)</p>


<figure >
    
        <img src="/media/advancedprotection/feitiankey.jpg" width="300" />
    
    
    <figcaption>
        <h4>Feitian Bluetooth/NFC U2F key</h4>
        
    </figcaption>
    
</figure>


<h3 id="blocking-non-google-apps">Blocking Non-Google apps</h3>

<p>To me, that&rsquo;s one of the main benefit of Advanced Protection. Standard Google accounts allows external applications to access Gmail/Google Drive data through the OAuth2 protocol. You see this feature in many website to use your gmail account as centralized authentication but it can also be use to request full access to your emails and data. This feature became largely known in May when <a href="https://www.wired.com/2017/05/dont-open-google-doc-unless-youre-positive-legit/">a large phishing campaign</a> used this trick to propagate to victim&rsquo;s contacts, but we knew <a href="http://blog.trendmicro.com/trendlabs-security-intelligence/pawn-storm-abuses-open-authentication-advanced-social-engineering-attacks/">since April</a> that this feature had been used in <a href="https://attack.mitre.org/wiki/Group/G0007">APT28</a> phishing campaigns.</p>


<figure >
    
        <img src="/media/advancedprotection/oauth.jpg" />
    
    
    <figcaption>
        <h4>Example of OAuth app requesting full access to emails (Source: TrendMicro)</h4>
        
    </figcaption>
    
</figure>


<p>Google also allows to define application passwords, which are passwords you can use for specific applications to access your emails without second factor (commonly used for Thunderbird/Outlook connection).</p>

<p>The drawback of this protection is that many third party apps will be blocked, according to the <a href="https://landing.google.com/advancedprotection/">Google page</a> it is only possible to access Gmail through your browser (no Outlook or Thunderbird), and Apple apps on iOS (Mail, Contact and Calendar) won&rsquo;t work, you will have to use Google apps.</p>

<h3 id="google-malware-scanner">Google Malware Scanner</h3>

<p>This feature is not clear to me, Google does communicate on their protections (in May <a href="https://www.blog.google/products/g-suite/keeping-your-company-data-safe-new-security-updates-gmail/">they published </a> about how they now use machine learning for malware detection in GSuite for instance), but not really on their implementations.</p>

<p>According to <a href="https://www.wired.com/story/google-advanced-protection-locks-down-accounts/">Wired</a>, this feature would delay email reception by more than 60 seconds. My guess is that either they use dynamic analysis on attached file for malware detection, or they request content of links included in emails to check for malicious pages (which seems more likely as this feature was added in GSuite <a href="https://gsuiteupdates.googleblog.com/2017/05/early-detection-of-phishing-via-delayed-delivery.html">recently</a>).</p>

<h3 id="extra-steps-for-account-recovery">Extra Steps for Account Recovery</h3>

<p>The implementation of this feature is not clear either, the <a href="https://landing.google.com/advancedprotection/">Google Page</a> explains that <em>&ldquo;Advanced Protection adds extra steps to verify your identity. If you ever lose access to your account and both of your Security Keys, these added verification requirements will take a few days to restore access to your account&rdquo;</em>. For now, Google uses different methods to confirms that you are the owner of an account (any 2FA you could have, recovery address but also creation date of the account or a secret question). It is unclear to me what changes in this process (and Google likely won&rsquo;t communicate about it).</p>

<h1 id="step-by-step-guide">Step by Step Guide</h1>

<p>So let&rsquo;s do this, first go on the Advanced Protection page : <a href="https://landing.google.com/advancedprotection/">https://landing.google.com/advancedprotection/</a></p>


<figure >
    
        <img src="/media/advancedprotection/start.png" width="600" />
    
    
</figure>


<p>Google ask confirmation that you own both U2F devices, or proposes to buy <a href="https://www.amazon.com/Feitian-MultiPass-FIDO-Security-Key/dp/B01LYV6TQM">this one</a> and <a href="https://www.amazon.com/Yubico-Y-123-FIDO-U2F-Security/dp/B00NLKA0D8">this one</a>. I only have USB devices for know but it should be enough for tests.</p>


<figure >
    
        <img src="/media/advancedprotection/step1.png" width="600" />
    
    
</figure>


<p>Then it requires to install 2 security keys :</p>


<figure >
    
        <img src="/media/advancedprotection/step2.png" width="600" />
    
    
</figure>


<p>As I don&rsquo;t have any bluetooth dongle yet, I am adding two tests YubiKeys</p>


<figure >
    
        <img src="/media/advancedprotection/step3.png" width="600" />
    
    
</figure>


<p>Last confirmation:

<figure >
    
        <img src="/media/advancedprotection/step4.png" width="600" />
    
    
</figure>
</p>

<p>Success!</p>


<figure >
    
        <img src="/media/advancedprotection/success.png" />
    
    
</figure>


<h1 id="tests">Tests</h1>

<p>Let&rsquo;s first test the delays due to the malware scan:</p>

<ul>
<li>For text only emails, I have not seen any delay at all</li>
<li>For links, I have not experienced any delay (but it may be because they were already known by Google)</li>
<li>For attached file (I tried with a doc), it was delayed around 2 minutes</li>
</ul>

<p>I have used the <a href="https://developers.google.com/oauthplayground/">OAuth playground</a> to try OAuth2 access : I was able to access calendar and contact information, but both Gmail and Gdrive were indeed blocked :</p>

<p><img src="/media/advancedprotection/nope.png" alt="Nope" /></p>

<p>Application passwords are just not available anymore in the interface.</p>

<p>I tried to recover the account, by giving the creation date and an unrelated email and got this question :</p>

<p><img src="/media/advancedprotection/test.png" alt="Test" /></p>

<p>It does not seem to be different to me from a standard account, but Google may have different processes for the manual background checks, hard to know.</p>

<h1 id="conclusion">Conclusion</h1>

<p>Besides the recurrent is-Google-in-your-threat-model question, I find thee features interesting as it clearly increases the security of your account (especially for app specific access which is more and more used in phishing attacks). But as John-Scott Railton <a href="https://www.johnscottrailton.com/security-for-the-high-risk-user/">has rightly argued</a>, <strong>security features are not efficient if they are intended for high-risk users only and disabled by default</strong>. Some people will indeed be ready to take time and accept usability tradeoffs to increase their security level, but it is likely that a majority of high-risk users won&rsquo;t take such steps for thousands of different and legitimate reasons (from a lack of time, to a real need to use some softwares). Or even more likely : they don&rsquo;t consider themselves as high-risk users.</p>

<p><strong>Google should invest time and effort into bringing these improvements for common users</strong>, and in some cases it could be done pretty easily. Let&rsquo;s take OAuth2 authentication for instance : I think 99% of users don&rsquo;t use OAuth for anything else than central authentication. It would make sense to have access to sensitive data (emails, drive and calendar) blocked by default in Gmail with an easy way to unlock it. Suddenly 99% of users become protected against OAuth phishing versus years of trainings to explain what is OAuth and how it can be abused (which is what we are doing right now).</p>

<p>You can contact me on <a href="https://twitter.com/tenacioustek">Twitter</a> if you have any comment or feedback on this article.</p>

  </div>
  
</div>




<script src="https://www.randhome.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

